<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="html">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.148.2">
    <meta name="generator" content="Relearn 8.0.0+9803d5122ebb3276acea823f476e9eb44f607862">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="Module 3: Collections and Scripting Now that we have built up our API specification and committed our work, it’s time to move into the Collections phase of the Insomnia workflow.
In this module, you will:
Generate a full request collection Understand how a complete specification improves collection generation Add basic scripting to streamline account management Commit your work and merge it back to main Prerequisites If you are starting the course from this module and have not completed the previous steps, you can import the Insomnia metadata to bring you up to date.">
    <meta name="author" content="">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:description" content="Module 3: Collections and Scripting Now that we have built up our API specification and committed our work, it’s time to move into the Collections phase of the Insomnia workflow.
In this module, you will:
Generate a full request collection Understand how a complete specification improves collection generation Add basic scripting to streamline account management Commit your work and merge it back to main Prerequisites If you are starting the course from this module and have not completed the previous steps, you can import the Insomnia metadata to bring you up to date.">
    <meta property="og:url" content="http://localhost:1313/04-collections/03-01-collections-readme/index.html">
    <meta property="og:site_name" content="APIOps with Kong Konnet and Insomnia">
    <meta property="og:description" content="Module 3: Collections and Scripting Now that we have built up our API specification and committed our work, it’s time to move into the Collections phase of the Insomnia workflow.
In this module, you will:
Generate a full request collection Understand how a complete specification improves collection generation Add basic scripting to streamline account management Commit your work and merge it back to main Prerequisites If you are starting the course from this module and have not completed the previous steps, you can import the Insomnia metadata to bring you up to date.">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="04-Collections">
    <meta itemprop="description" content="Module 3: Collections and Scripting Now that we have built up our API specification and committed our work, it’s time to move into the Collections phase of the Insomnia workflow.
In this module, you will:
Generate a full request collection Understand how a complete specification improves collection generation Add basic scripting to streamline account management Commit your work and merge it back to main Prerequisites If you are starting the course from this module and have not completed the previous steps, you can import the Insomnia metadata to bring you up to date.">
    <meta itemprop="wordCount" content="1447">
    <title></title>
    <link href="/css/auto-complete/auto-complete.min.css?1754657266" rel="stylesheet">
    <script src="/js/auto-complete/auto-complete.min.js?1754657266" defer></script>
    <script src="/js/search-lunr.js?1754657266" defer></script>
    <script src="/js/search.js?1754657266" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/searchindex.en.js?1754657266";
    </script>
    <script src="/js/lunr/lunr.min.js?1754657266" defer></script>
    <script src="/js/lunr/lunr.stemmer.support.min.js?1754657266" defer></script>
    <script src="/js/lunr/lunr.multi.min.js?1754657266" defer></script>
    <script src="/js/lunr/lunr.en.min.js?1754657266" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/fonts/fontawesome/css/fontawesome-all.min.css?1754657266" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/fonts/fontawesome/css/fontawesome-all.min.css?1754657266" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar/perfect-scrollbar.min.css?1754657266" rel="stylesheet">
    <link href="/css/theme.css?1754657266" rel="stylesheet">
    <link href="/css/format-html.css?1754657266" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = ``;
      window.relearn.path='\/04-collections\/03-01-collections-readme\/index.html';
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..';
      window.relearn.absBaseUri='http:\/\/localhost:1313';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=false;
      window.relearn.enableBlockCodeWrap=true;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'blue' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script>
  </head>
  <body class="mobile-support html" data-url="/04-collections/03-01-collections-readme/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
<nav class="TableOfContents">
  <ul>
    <li><a href="#prerequisites">Prerequisites</a></li>
    <li><a href="#introduction-to-scripting-in-insomnia">Introduction to Scripting in Insomnia</a></li>
    <li><a href="#step-1-create-a-feature-branch">Step 1: Create a Feature Branch</a></li>
    <li><a href="#step-2-generate-a-request-collection">Step 2: Generate a Request Collection</a></li>
    <li><a href="#step-3-understanding-pre--and-after-response-scripts">Step 3: Understanding Pre- and After-Response Scripts</a></li>
    <li><a href="#step-4-add-after-response-script-to-store-accountid">Step 4: Add After-Response Script to Store <code>accountId</code></a>
      <ul>
        <li><a href="#example-response">Example Response</a></li>
        <li><a href="#optional-quick-validation-example">Optional Quick Validation Example</a></li>
      </ul>
    </li>
    <li><a href="#step-5-add-pre-request-script-to-auto-create-an-account-if-needed">Step 5: Add Pre-Request Script to Auto-Create an Account if Needed</a>
      <ul>
        <li><a href="#description-of-the-insomnia-pre-request-script">Description of the Insomnia Pre-request Script</a></li>
        <li><a href="#purpose">Purpose</a></li>
        <li><a href="#run-the-requests">Run the Requests</a></li>
      </ul>
    </li>
    <li><a href="#step-6-commit-and-push-your-changes">Step 6: Commit and Push Your Changes</a></li>
    <li><a href="#step-7-raise-a-pull-request">Step 7: Raise a Pull Request</a></li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav>
                </div>
              </div>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/index.html"><span itemprop="name">APIOps with Kong Konnect and Insomnia</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/04-collections/index.html"><span itemprop="name">04-Collections</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/04-collections/index.html" title="04-Collections (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/05-testing/index.html" title="05-Testings (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable 04-collections" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id=""></h1>

<h1 id="module-3-collections-and-scripting">Module 3: Collections and Scripting</h1>
<p>Now that we have built up our API specification and committed our work, it&rsquo;s time to move into the <strong>Collections</strong> phase of the Insomnia workflow.</p>
<p>In this module, you will:</p>
<ul>
<li>Generate a full request collection</li>
<li>Understand how a complete specification improves collection generation</li>
<li>Add basic scripting to streamline account management</li>
<li>Commit your work and merge it back to <code>main</code></li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<p>If you are starting the course from this module and have not completed the previous steps, you can import the Insomnia metadata to bring you up to date.</p>
<!-- raw HTML omitted -->
<ol>
<li>
<p>Clone the <code>insomnia-workshop-exports</code> repository:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git clone https://github.com/KongHQ-CX/insomnia-workshop-exports.git</span></span></code></pre></div>
<blockquote>
<p>Note: <code>https://github.com/konghq-cx</code> is the address for the public version of this repository, if your company uses an enterprise git offering then this address will be updated in the course notes.</p></blockquote>
</li>
<li>
<p>The structure of the repository is:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>insomnia-workshop-exports
</span></span><span style="display:flex;"><span>|── accounts-service
</span></span><span style="display:flex;"><span>│   ├── module-02
</span></span><span style="display:flex;"><span>│   │   └── api-spec
</span></span><span style="display:flex;"><span>│   │       └── module-2-end-state.yaml
</span></span><span style="display:flex;"><span>│   ├── module-03
</span></span><span style="display:flex;"><span>│   ├── module-04
</span></span><span style="display:flex;"><span>│   │   └── api-spec
</span></span><span style="display:flex;"><span>│   │       └── module-04-end-state.yaml
</span></span><span style="display:flex;"><span>│   ├── module-05
</span></span><span style="display:flex;"><span>│   │   └── api-spec
</span></span><span style="display:flex;"><span>│   │       └── module-05-end-state.yaml
</span></span><span style="display:flex;"><span>│   ├── module-06
</span></span><span style="display:flex;"><span>│   │   └── api-spec
</span></span><span style="display:flex;"><span>│   │       └── module-06-end-state.yaml
</span></span><span style="display:flex;"><span>│   ├── module-07
</span></span><span style="display:flex;"><span>│   │   ├── api-spec
</span></span><span style="display:flex;"><span>│   │   │   └── module-07-end-state.yaml
</span></span><span style="display:flex;"><span>│   │   └── mock-spec
</span></span><span style="display:flex;"><span>│   │       └── module-07-mock-end-state.yaml
</span></span><span style="display:flex;"><span>├── README.md
</span></span><span style="display:flex;"><span>└── transactions-service
</span></span><span style="display:flex;"><span>    ├── module-07
</span></span><span style="display:flex;"><span>    │   ├── api-spec
</span></span><span style="display:flex;"><span>    │   │   └── module-07-end-state.yaml
</span></span><span style="display:flex;"><span>    │   └── mock-spec
</span></span><span style="display:flex;"><span>    │       └── module-07-mock-end-state.yaml
</span></span><span style="display:flex;"><span>    └── module-08
</span></span><span style="display:flex;"><span>        └── api-spec
</span></span><span style="display:flex;"><span>            └── module-08-end-state.yaml</span></span></code></pre></div>
</li>
<li>
<p>Import the correct &ldquo;end state&rdquo; YAML file for the previous module.</p>
<ul>
<li>Example: If starting Module 3, import <code>accounts-service/module-02/api-spec/module-2-end-state.yaml</code> into Insomnia.</li>
</ul>
</li>
</ol>
<blockquote>
<p><strong>Note:</strong> Some modules also include mock metadata. In those cases, import both the <code>api-spec</code> and <code>mock-spec</code> files.</p></blockquote>
<!-- raw HTML omitted -->
<p>This ensures you are starting the module with the correct project state.</p>
<h2 id="introduction-to-scripting-in-insomnia">Introduction to Scripting in Insomnia</h2>
<p>In this module, we will explore generating request collections and custom scripting in Insomnia. By now, your <code>OpenAPI</code> specification file fully formed and we are ready to generate our requests and utilise Insomnia scripting if required.</p>
<p>Insomnia supports pre-request and after-response scripting — lightweight JavaScript snippets that run either <em>before</em> a request is sent or <em>after</em> the response is received. These scripts are incredibly useful for preparing data, chaining requests, validating responses, or working with environment variables.</p>
<h2 id="step-1-create-a-feature-branch">Step 1: Create a Feature Branch</h2>
<p>Before we begin working with scripts, let&rsquo;s create a feature branch to manage these changes:</p>
<ol>
<li>In Insomnia, click on the branch name in the Git panel (lower left corner)</li>
<li>Create a new branch named: <code>feature/api-collections-and-scripting</code></li>
<li>Click &ldquo;Create&rdquo; to switch to the new branch.</li>
</ol>
<p><a href="#R-image-f56fee66482c48e3dd0d323cbaafd004" class="lightbox-link"><img alt="<code>module-03-feature-branch</code>" class="lazy lightbox figure-image" loading="lazy" src="./images/module-03-feature-branch.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f56fee66482c48e3dd0d323cbaafd004"><img alt="<code>module-03-feature-branch</code>" class="lazy lightbox lightbox-image" loading="lazy" src="./images/module-03-feature-branch.png"></a></p>
<blockquote>
<p>This branch will contain all of our collection requests &amp; scripting additions, keeping them isolated until we&rsquo;re ready to share with the team.</p></blockquote>
<h2 id="step-2-generate-a-request-collection">Step 2: Generate a Request Collection</h2>
<p>Now generate the request collection based on your final spec.</p>
<ol>
<li>In the sidebar under <strong>Spec</strong>, click the gear icon next to the words <code>Spec</code> and <code>Preview</code>.</li>
<li>Select <strong>Generate Collection</strong>.
<a href="#R-image-07dee7bf8ba5b91723f397e2c6b3e279" class="lightbox-link"><img alt="<code>module-03-generate-collection</code>" class="lazy lightbox figure-image" loading="lazy" src="./images/module-03-generate-collection.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-07dee7bf8ba5b91723f397e2c6b3e279"><img alt="<code>module-03-generate-collection</code>" class="lazy lightbox lightbox-image" loading="lazy" src="./images/module-03-generate-collection.png"></a>
This will:</li>
</ol>
<ul>
<li>Create structured requests for each endpoint</li>
<li>Apply example request bodies and parameters</li>
<li>Group requests by tag (e.g., <code>health</code>, <code>accounts</code>)</li>
<li>Attach appropriate validation schemas</li>
</ul>
<p><a href="#R-image-a48bddfc95a0b10834bb81106837ac97" class="lightbox-link"><img alt="<code>module-03-collection-full-generated</code>" class="lazy lightbox figure-image" loading="lazy" src="./images/module-03-collection-full-generated.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-a48bddfc95a0b10834bb81106837ac97"><img alt="<code>module-03-collection-full-generated</code>" class="lazy lightbox lightbox-image" loading="lazy" src="./images/module-03-collection-full-generated.png"></a></p>
<blockquote>
<p><strong>Note:</strong> This demonstrates the value of a complete specification — better examples, validations, and structure are automatically included.</p></blockquote>
<p>From the collections screen we should also update our environment. To do this:</p>
<ul>
<li>Click on the <code>Base Environment</code> on the top right-hand side of the <code>Collections</code> screen</li>
<li>Then select the edit symbol
<a href="#R-image-7b56e1da1f63e6c2c95e8f9926b638c0" class="lightbox-link"><img alt="<code>module-03-select-env</code>" class="lazy lightbox figure-image" loading="lazy" src="./images/module-03-select-env.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-7b56e1da1f63e6c2c95e8f9926b638c0"><img alt="<code>module-03-select-env</code>" class="lazy lightbox lightbox-image" loading="lazy" src="./images/module-03-select-env.png"></a></li>
<li>Once in the environment editing window, make sure your <code>Base Environment</code>: <code>base_url</code> variable looks like this: <code>&quot;{{ _.scheme }}://{{ _.host }}&quot;</code>
<a href="#R-image-ee2fb4da3e75d79db3dcee0af58ca07d" class="lightbox-link"><img alt="<code>module-03-base-env</code>" class="lazy lightbox figure-image" loading="lazy" src="./images/module-03-base-env.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-ee2fb4da3e75d79db3dcee0af58ca07d"><img alt="<code>module-03-base-env</code>" class="lazy lightbox lightbox-image" loading="lazy" src="./images/module-03-base-env.png"></a></li>
<li>And your auto generated <code>OpenAPI env localhost:8081</code> environment variables look like this:</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;scheme&#34;</span>: <span style="color:#e6db74">&#34;http&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;host&#34;</span>: <span style="color:#e6db74">&#34;localhost:8081&#34;</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p><a href="#R-image-05879032af5d7a6032e4db860b2af493" class="lightbox-link"><img alt="<code>module-03-local-env</code>" class="lazy lightbox figure-image" loading="lazy" src="./images/module-03-local-env.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-05879032af5d7a6032e4db860b2af493"><img alt="<code>module-03-local-env</code>" class="lazy lightbox lightbox-image" loading="lazy" src="./images/module-03-local-env.png"></a></p>
<p>When leaving the environment editor window make sure the <code>OpenAPI env localhost:8081</code> environment is selected</p>
<p><a href="#R-image-193c3be37cba9cc82cde9500a703598c" class="lightbox-link"><img alt="<code>module-03-local-env-selected</code>" class="lazy lightbox figure-image" loading="lazy" src="./images/module-03-local-env-selected.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-193c3be37cba9cc82cde9500a703598c"><img alt="<code>module-03-local-env-selected</code>" class="lazy lightbox lightbox-image" loading="lazy" src="./images/module-03-local-env-selected.png"></a></p>
<h2 id="step-3-understanding-pre--and-after-response-scripts">Step 3: Understanding Pre- and After-Response Scripts</h2>
<p><strong>Pre-request scripts</strong> run <em>before</em> your request is sent. Common use cases include:</p>
<ul>
<li>Setting environment variables</li>
<li>Authenticating with tokens</li>
<li>Creating prerequisite data (e.g., a bank account before making a deposit)</li>
</ul>
<blockquote>
<p><a href="https://docs.insomnia.rest/insomnia/pre-request-script" rel="external" target="_blank">Insomnia Docs: Pre-request scripting</a></p></blockquote>
<p><strong>After-response scripts</strong> run <em>after</em> the response is received. They&rsquo;re ideal for:</p>
<ul>
<li>Extracting data from the response and storing it for later use</li>
<li>Viewing or logging response data</li>
<li>Simple validation and verification tasks</li>
</ul>
<blockquote>
<p><a href="https://docs.insomnia.rest/insomnia/after-response-script" rel="external" target="_blank">Insomnia Docs: After-response scripting</a></p></blockquote>
<h2 id="step-4-add-after-response-script-to-store-accountid">Step 4: Add After-Response Script to Store <code>accountId</code></h2>
<p>In the &ldquo;Create a new account&rdquo; request:</p>
<ol>
<li>Select the request.</li>
<li>Go to the <strong>Scripts</strong> tab.</li>
<li>Add an <strong>After-Response Script</strong>:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// Extract account_id from the response and store it in the environment
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">insomnia</span>.<span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">json</span>();
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">insomnia</span>.<span style="color:#a6e22e">environment</span>.<span style="color:#a6e22e">set</span>(<span style="color:#e6db74">&#34;accountId&#34;</span>, <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">account_id</span>);</span></span></code></pre></div>
<p>This script will automatically save the <code>accountId</code> of a newly created account, making follow-up actions much easier.</p>
<h3 id="example-response">Example Response</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;account_id&#34;</span>: <span style="color:#e6db74">&#34;88c09a4f-bcab-450f-a86f-d4c074f2fab9&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;savings&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;balance&#34;</span>: <span style="color:#ae81ff">5000</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="optional-quick-validation-example">Optional Quick Validation Example</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`Response status: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">insomnia</span>.<span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">code</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">insomnia</span>.<span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">code</span> <span style="color:#f92672">!==</span> <span style="color:#ae81ff">201</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;Warning: Unexpected status code&#34;</span>);
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>While useful during development, for production-grade testing we recommend using proper Test Suites (covered in Module 4).</p>
<p>Please run the request now by clicking the send button to validate it is working.</p>
<p><a href="#R-image-635d0421bbb19d317f4c61aced3f021e" class="lightbox-link"><img alt="<code>module-03-create-account-request</code>" class="lazy lightbox figure-image" loading="lazy" src="./images/module-03-create-account-response.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-635d0421bbb19d317f4c61aced3f021e"><img alt="<code>module-03-create-account-request</code>" class="lazy lightbox lightbox-image" loading="lazy" src="./images/module-03-create-account-response.png"></a></p>
<p>You can also validate the <code>accountId</code> environment variable has been set by clicking on the <code>OpenAPI env localhost:8081</code> environment and selecting the edit icon.</p>
<p><a href="#R-image-5541ca88ad667ef2b46ecc666a1593cd" class="lightbox-link"><img alt="<code>module-03-local-env-account-id</code>" class="lazy lightbox figure-image" loading="lazy" src="./images/module-03-local-env-account-id.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-5541ca88ad667ef2b46ecc666a1593cd"><img alt="<code>module-03-local-env-account-id</code>" class="lazy lightbox lightbox-image" loading="lazy" src="./images/module-03-local-env-account-id.png"></a></p>
<h2 id="step-5-add-pre-request-script-to-auto-create-an-account-if-needed">Step 5: Add Pre-Request Script to Auto-Create an Account if Needed</h2>
<p>Several requests assume the presence of a valid <code>accountId</code>:</p>
<ul>
<li><strong>Credit an account</strong></li>
<li><strong>Debit an account</strong></li>
<li><strong>Retrieve a single account</strong></li>
</ul>
<p>To automate this:</p>
<p>Add a <strong>Pre-Request Script</strong> for each of these requests:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">insomnia</span>.<span style="color:#a6e22e">environment</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;accountId&#34;</span>)) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">host</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">insomnia</span>.<span style="color:#a6e22e">environment</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;host&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">scheme</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">insomnia</span>.<span style="color:#a6e22e">environment</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;scheme&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">baseUrl</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">scheme</span><span style="color:#e6db74">}</span><span style="color:#e6db74">://</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">host</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">createAccountRequest</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">url</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">baseUrl</span><span style="color:#e6db74">}</span><span style="color:#e6db74">/accounts`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">method</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;POST&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#39;Content-Type&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;application/json&#39;</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">body</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">mode</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;raw&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">raw</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;savings&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">initial_balance</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">5000.00</span>,
</span></span><span style="display:flex;"><span>      }),
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#66d9ef">new</span> Promise((<span style="color:#a6e22e">resolve</span>, <span style="color:#a6e22e">reject</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">insomnia</span>.<span style="color:#a6e22e">sendRequest</span>(<span style="color:#a6e22e">createAccountRequest</span>, (<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">resp</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) <span style="color:#a6e22e">reject</span>(<span style="color:#a6e22e">err</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">else</span> <span style="color:#a6e22e">resolve</span>(<span style="color:#a6e22e">resp</span>);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">code</span> <span style="color:#f92672">!==</span> <span style="color:#ae81ff">201</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">`Account creation failed. Status code: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">code</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">responseBody</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">toString</span>());
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">insomnia</span>.<span style="color:#a6e22e">environment</span>.<span style="color:#a6e22e">set</span>(<span style="color:#e6db74">&#39;accountId&#39;</span>, <span style="color:#a6e22e">responseBody</span>.<span style="color:#a6e22e">account_id</span>);
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>This ensures your tests are reliable and do not depend on manual setup.</p>
<h3 id="description-of-the-insomnia-pre-request-script">Description of the Insomnia Pre-request Script</h3>
<p>This pre-request script dynamically manages the creation of an <code>accountId</code> if it does not already exist in the Insomnia environment. Here is a detailed breakdown of its actions:</p>
<ol>
<li>
<p><strong>Check for Existing <code>accountId</code></strong>:</p>
<ul>
<li>The script first checks whether the <code>accountId</code> environment variable is already set.</li>
</ul>
</li>
<li>
<p><strong>Retrieve Environment Variables</strong>:</p>
<ul>
<li>If <code>accountId</code> is not set, it retrieves the <code>host</code> and <code>scheme</code> environment variables.</li>
<li>It constructs the <code>baseUrl</code> by combining <code>scheme</code> and <code>host</code>.</li>
</ul>
</li>
<li>
<p><strong>Prepare the Account Creation Request</strong>:</p>
<ul>
<li>It defines a <code>createAccountRequest</code> object configured to:
<ul>
<li>Use the <code>POST</code> method.</li>
<li>Target the <code>/accounts</code> endpoint at the constructed <code>baseUrl</code>.</li>
<li>Set the <code>Content-Type</code> header to <code>application/json</code>.</li>
<li>Send a JSON payload specifying the creation of a <code>savings</code> account with an initial balance of <code>5000.00</code>.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Send the Account Creation Request</strong>:</p>
<ul>
<li>It uses <code>insomnia.sendRequest</code> within a <code>Promise</code> to handle asynchronous execution.</li>
<li>If the request encounters an error, it is rejected. Otherwise, the response is resolved.</li>
</ul>
</li>
<li>
<p><strong>Handle the Response</strong>:</p>
<ul>
<li>The script checks if the HTTP status code of the response is <code>201</code> (Created).</li>
<li>If the status code is not <code>201</code>, it throws an error indicating account creation failure.</li>
</ul>
</li>
<li>
<p><strong>Extract and Store the <code>accountId</code></strong>:</p>
<ul>
<li>It parses the response body to extract the <code>account_id</code>.</li>
<li>It then sets the <code>accountId</code> in the environment variables for subsequent use.</li>
</ul>
</li>
</ol>
<h3 id="purpose">Purpose</h3>
<p>This script ensures that each request requiring an <code>accountId</code> has one readily available, avoiding manual setup or prior dependency on external processes. It dynamically manages prerequisites, improving automation and reducing potential human error during testing or development workflows.</p>
<h3 id="run-the-requests">Run the Requests</h3>
<p>Once you have added the pre-request scripts to the <code>Credit an account</code>, <code>Debit an account</code> and the <code>Retrieve a single account</code> requests, execute each request by hitting the <code>Send</code> button for each one.</p>
<ul>
<li>
<p><code>Credit an account</code> Response Example:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;account_id&#34;</span>: <span style="color:#e6db74">&#34;88c09a4f-bcab-450f-a86f-d4c074f2fab9&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;savings&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;balance&#34;</span>: <span style="color:#ae81ff">5100</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Note the increased balance to 5100</p>
</li>
<li>
<p><code>Debit an account</code> Response Example</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;account_id&#34;</span>: <span style="color:#e6db74">&#34;88c09a4f-bcab-450f-a86f-d4c074f2fab9&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;savings&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;balance&#34;</span>: <span style="color:#ae81ff">5000</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Note the decreased balance back to 5000</p>
</li>
<li>
<p><code>Retrieve a single account</code> Response Example</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;account_id&#34;</span>: <span style="color:#e6db74">&#34;88c09a4f-bcab-450f-a86f-d4c074f2fab9&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;savings&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;balance&#34;</span>: <span style="color:#ae81ff">5000</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Note the expected balance is 5000</p>
</li>
</ul>
<h2 id="step-6-commit-and-push-your-changes">Step 6: Commit and Push Your Changes</h2>
<p>Use the Insomnia Git commit menu:</p>
<ol>
<li>Click on the Git dropdown in the left sidebar.</li>
<li>Select &ldquo;Commit&rdquo;.</li>
<li>Inspect the changes.</li>
<li>If happy, stage the changes.</li>
<li>Enter a meaningful commit message: <code>feat: generate collection and add scripting for automatic account management</code></li>
<li>Click <strong>Commit</strong>.</li>
<li>Click <strong>Push</strong> to update your remote repository.</li>
</ol>
<p><a href="#R-image-65c4147a770f0a2c1a19605665e75d95" class="lightbox-link"><img alt="<code>module-03-final-commit</code>" class="lazy lightbox figure-image" loading="lazy" src="./images/module-03-final-commit.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-65c4147a770f0a2c1a19605665e75d95"><img alt="<code>module-03-final-commit</code>" class="lazy lightbox lightbox-image" loading="lazy" src="./images/module-03-final-commit.png"></a></p>
<h2 id="step-7-raise-a-pull-request">Step 7: Raise a Pull Request</h2>
<p>After committing and pushing:</p>
<ul>
<li>Create a pull request from your <code>feature/api-collections-and-scripting</code> branch into <code>main</code>.</li>
<li>Once reviewed, merge your branch to keep the <code>main</code> branch up-to-date with your completed work.</li>
</ul>
<h2 id="summary">Summary</h2>
<p>You have now:</p>
<ul>
<li>Generated a complete and structured collection</li>
<li>Learned how and when to use pre-request and after-response scripting</li>
<li>Added scripts to automate account creation and ID management</li>
<li>Committed and merged your changes back into <code>main</code></li>
</ul>
<p><strong>Next:</strong> <code>In Module 4 - Testing</code>, we&rsquo;ll focus on writing structured, reusable test suites for our API!</p>

  <footer class="footline">
  </footer>
</article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
          <a id="R-logo" class="R-default" href="/index.html">
            <div class="logo-title">APIOps with Kong Konnet and Insomnia</div>
          </a>
        </div>
        <search><form action="/search/index.html" method="get">
          <div class="searchbox default-animation">
            <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
            <label class="a11y-only" for="R-search-by">Search</label>
            <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
            <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
          </div>
        </form></search>
      </div>
      <div id="R-homelinks" class="default-animation homelinks">
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-homelinks">
          <ul class="space collapsible-menu">
            <li class="" data-nav-id="/index.html"><a class="padding" href="/index.html"><i class="fa-fw fas fa-home"></i> Home</a></li>
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-headercontrols">
          <ul class="">
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div class="R-sidebarmenu R-shortcutmenu-main">
          <ul class="enlarge morespace collapsible-menu">
            <li class="" data-nav-id="/01-insomnia-overview/index.html"><a class="padding" href="/01-insomnia-overview/index.html">Insomnia Overview</a></li>
            <li class="" data-nav-id="/01-project-setup-and-git-integration/index.html"><a class="padding" href="/01-project-setup-and-git-integration/index.html">Module 1: Project Setup and Git Integration</a></li>
            <li class="" data-nav-id="/02-designing-an-api-specification/index.html"><a class="padding" href="/02-designing-an-api-specification/index.html">02-Designing-an-Api-Specifications</a></li>
            <li class="parent " data-nav-id="/04-collections/index.html"><a class="padding" href="/04-collections/index.html">04-Collections</a><ul id="R-subsections-748aac557ec6319aca8152320bc0bbbb" class="collapsible-menu">
            <li class="active hidden " data-nav-id="/04-collections/03-01-collections-readme/index.html"><a class="padding" href="/04-collections/03-01-collections-readme/index.html"></a></li></ul></li>
            <li class="" data-nav-id="/05-testing/index.html"><a class="padding" href="/05-testing/index.html">05-Testings</a></li>
            <li class="" data-nav-id="/06-custom-linting/index.html"><a class="padding" href="/06-custom-linting/index.html">06-Custom-Lintings</a></li>
            <li class="" data-nav-id="/07-cicd-testing/index.html"><a class="padding" href="/07-cicd-testing/index.html">07-CICD-Testings</a></li>
            <li class="" data-nav-id="/08-mocking/index.html"><a class="padding" href="/08-mocking/index.html">08-Mockings</a></li>
            <li class="" data-nav-id="/09-secrets-and-secure-collaboration/index.html"><a class="padding" href="/09-secrets-and-secure-collaboration/index.html">09-Secrets-and-Secure-Collaborations</a></li>
          </ul>
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-shortcuts">
          <ul class="space collapsible-menu">
          </ul>
        </div>
        <div id="R-footer-margin"></div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-footercontrols">
          <ul class="">
          </ul>
        </div>
<div id="R-footer"><p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p></div>
      </div>
    </aside>
    <script src="/js/clipboard/clipboard.min.js?1754657266" defer></script>
    <script src="/js/perfect-scrollbar/perfect-scrollbar.min.js?1754657266" defer></script>
    <script src="/js/theme.js?1754657266" defer></script>
  </body>
</html>
